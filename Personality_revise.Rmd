---
title: "Personality_revise"
output: 
  github_document:
  html_document: default
  pdf_document: default
sansfont: Noto Sans
monofont: Noto Mono
---
```{r フォント設定}
require(fontregisterer)
if(Sys.info()["sysname"] == "Windows"){
  if(as.integer(str_extract(Sys.info()["release"], "^[0-9]+")) >=8){
    family_sans <- "Yu Gothic"
    family_serif <- "Yu Mincho"
    } else {
    family_sans <- "MS Gothic"
    family_serif <- "MS Mincho"
    }
  } else if(Sys.info()["sysname"] == "Linux") {
    family_sans <- "Noto Sans CJK JP"
    family_serif <- "Noto Serif CJK JP"
  } else if(Sys.info()["sysname"] == "Darwin"){
    family_serif <- "Hiragino Mincho ProN"
    family_sans <- "Hiragino Sans"
  } else {
    # インストールすればとりあえず動く
    family_sans <- "Noto Sans CJK JP"
    family_serif <- "Noto Serif CJK JP"
  }
knitr::opts_chunk$set(
  dev = "png",
  dev.args = list(family = family_sans)
)
```


## libraryインポート
```{r library}
library(tidyverse)
library(magrittr)
library(psych)
```

## データ整形
データのインポート, 分割, 修正
```{r レベル別データ, warning=FALSE}
df <- read.csv("~/OneDrive - keio.jp/藤井研/個人研究/個人差実験/実験1/20220514_originaldata.csv",header = T)
#PersonalレベルとContextレベルにデータを分割
df_Person <- df[,1:117] %>%  sapply(., as.numeric) %>% as.data.frame() %>% tibble()
df_Context <- df[,118:447] %>% sapply(., as.numeric) %>% as.data.frame() %>% tibble()
```


Contextデータの整形
```{r Contextデータの整形}
for(i in 1:33){
  xname <- paste("s",i,sep = "")
  df_x <- select(df_Context, starts_with(paste0("X",i,"_"))) %>% mutate(no = seq(54))
  colnames(df_x) <- c("Experience","Nostalgia","Arousal","Valence", "Emotion", "SongFamiliarity","GenreFamiliarity","AutobiographicalSalience","Aethetic","Impression","no")
  assign(xname,df_x)
}

Context <- bind_rows(s1,s2,s3,s4,s5,s6,s7,s8,s9,s10,
          s11,s12,s13,s14,s15,s16,s17,s18,s19,s20,
          s21,s22,s23,s24,s25,s26,s27,s28,s29,s30,
          s31,s32,s33) %>% select(no,everything())

```

感情データ結合
```{r 感情データ結合}
Nostalgia_Personality_Emotion <- read_csv("~/OneDrive - keio.jp/藤井研/個人研究/個人差実験/実験1/Nostalgia＿Personality_Emotion.csv")
Context_all <- cbind(Context, Nostalgia_Personality_Emotion) %>% select(-Emotion)%>% na.omit()
head(Context_all)
```
 データの分割（NN/AN)
```{r データ修正}
#クアルトリクスから誤ってインポートされたデータの修正
Context_all <- Context_all %>% mutate(
  Nostalgia = as.numeric(str_replace_all(Nostalgia, "7", "5")),
  Arousal = as.numeric(str_replace_all(Arousal, "7", "5")),
  Valence = as.numeric(str_replace_all(Valence, "9", "5")),
  SongFamiliarity = as.numeric(str_replace_all(SongFamiliarity, "7", "5")),
  GenreFamiliarity = as.numeric(str_replace_all(GenreFamiliarity, "7", "5")),
  AutobiographicalSalience = as.numeric(str_replace_all(AutobiographicalSalience, "7", "5")),
  Aethetic = as.numeric(str_replace_all(Aethetic, "7", "5")),
  Impression = as.numeric(str_replace_all(Impression, "7", "5"))
  )
```

聴取経験別にデータを分ける
```{r AN/NNデータ}
NN <- Context_all %>% filter(Experience == 2) 
AN <- Context_all %>% filter(Experience == 1)
```

## ノスタルジア経験概要
経験人数
```{r nost_summary}
#全ての試行数（810）
Context %>% na.omit() %>% nrow()
#ノスタルジア経験（3-5）（428）
Context %>% filter(Nostalgia > 2) %>% na.omit() %>% count()
round(428/810,3)#割合
#NN経験（3-5）(206)
Context %>% filter(Experience == 2 & Nostalgia > 2) %>% na.omit() %>% count()
Context %>% filter(Experience == 2) %>% na.omit() %>% count()
round(206/526,3)#割合
#AN経験（3-5）（222）
Context %>% filter(Experience == 1 & Nostalgia > 2) %>% na.omit() %>% count()
Context %>% filter(Experience == 1) %>% na.omit() %>% count()
round(222/284,3)#割合
```

ヒストグラム
```{r histogram, warning=FALSE}
library(cowplot)
par(family = "sans")

hist_theme <- theme(plot.title= element_text(hjust = 0.5, size = 15, face = "bold", colour = 1), 
      axis.title.x = element_text(size = 13, face = "bold", colour = 1),
      axis.text.x = element_text(size=11, colour = 1),
      axis.text.y = element_text(size=10, colour = 1),
      axis.title.y = element_text(size=13, face = "bold", colour = 1),
      legend.text=element_text(size=10))

N_hist <- ggplot2::ggplot(data = Context_all,aes(x = Nostalgia, y = ..count../sum(..count..))) + 
  ggplot2::geom_histogram(binwidth = function(x) ceiling((max(x) - min(x)) / sqrt(length(x))), 
                          fill="white", colour="black") + 
  scale_y_continuous(breaks=seq(0,0.5,0.05)) +
  labs(x = "ノスタルジアの強さ", y = "全試行における\nノスタルジア経験の割合") + hist_theme + 
  theme_minimal(base_family =family_sans)
  

NN_hist <- ggplot(data = NN,aes(x = Nostalgia, y = ..count../sum(..count..))) + 
  geom_histogram(binwidth = function(x) ceiling((max(x) - min(x)) / sqrt(length(x))), 
                 fill="white", colour="black") + 
  scale_y_continuous(breaks=seq(0,0.5,0.05)) + 
  labs(x = "ノスタルジアの強さ", y = "聴取経験を伴わない\nノスタルジア経験の割合") + hist_theme + 
  theme_minimal(base_family =family_sans)

AN_hist <- ggplot(data = AN,aes(x = Nostalgia, y = ..count../sum(..count..))) + 
  geom_histogram(binwidth = function(x) ceiling((max(x) - min(x)) / sqrt(length(x))), 
                 fill="white", colour="black") + 
  scale_y_continuous(breaks=seq(0,0.5,0.05)) +
  labs(x = "ノスタルジアの強さ", y = "聴取経験を伴った\nノスタルジア経験の割合") + hist_theme + 
  theme_minimal(base_family =family_sans)


title <- ggdraw() + draw_label("ノスタルジア経験", fontface='bold',size = 14)

bottom_row <- plot_grid(NN_hist, AN_hist, ncol = 2, labels = "AUTO")
p <- plot_grid(N_hist,NN_hist, AN_hist, nrow = 3, labels =  "AUTO", rel_heights = c(1, 1, 1))
p
```


## 文脈レベル解析
###  集団中心化
```{r centered}
NN$Arousal.cwc <- NN$Arousal -ave(NN$Arousal, NN$no) 
NN$Valence.cwc <- NN$Valence -ave(NN$Valence, NN$no) 
NN$SongFamiliarity.cwc <- NN$SongFamiliarity -ave(NN$SongFamiliarity, 
                                                                  NN$no) 
NN$GenreFamiliarity.cwc <- NN$GenreFamiliarity -ave(NN$GenreFamiliarity, 
                                                                    NN$no) 
NN$AutobiographicalSalience.cwc <- NN$AutobiographicalSalience -
  ave(NN$AutobiographicalSalience, NN$no) 
NN$Aethetic.cwc <- NN$Aethetic -ave(NN$Aethetic, NN$no) 
NN$Impression.cwc <- NN$Impression -ave(NN$Impression, NN$no) 
NN$NoPositive.cwc <- NN$NoPositive -ave(NN$NoPositive, NN$no) 
NN$NoNegative.cwc <- NN$NoNegative -ave(NN$NoNegative, NN$no) 

#AN
AN$Arousal.cwc <- AN$Arousal -ave(AN$Arousal, AN$no) 
AN$Valence.cwc <- AN$Valence -ave(AN$Valence, AN$no) 
AN$SongFamiliarity.cwc <- AN$SongFamiliarity -ave(AN$SongFamiliarity, 
                                                                  AN$no) 
AN$GenreFamiliarity.cwc <- AN$GenreFamiliarity -ave(AN$GenreFamiliarity, 
                                                                    AN$no) 
AN$AutobiographicalSalience.cwc <- AN$AutobiographicalSalience -
  ave(AN$AutobiographicalSalience, AN$no) 
AN$Aethetic.cwc <- AN$Aethetic -ave(AN$Aethetic, AN$no) 
AN$Impression.cwc <- AN$Impression -ave(AN$Impression, AN$no) 
AN$NoPositive.cwc <- AN$NoPositive -ave(AN$NoPositive, AN$no) 
AN$NoNegative.cwc <- AN$NoNegative -ave(AN$NoNegative, AN$no) 
```

ICC算出
```{r ICC}
library(ICC)
NN_ICC <- ICCest(as.factor(no),Nostalgia, data=NN, alpha = 0.05, CI.type = "Smith")
round(NN_ICC$ICC,3)
round(NN_ICC$varw,3)
round(NN_ICC$vara,3)
AN_ICC <- ICCest(as.factor(no),Nostalgia, data=AN, alpha = 0.05, CI.type = "Smith")
round(AN_ICC$ICC,3)
round(AN_ICC$varw,3)
round(AN_ICC$vara,3)
```
## 混合線形回帰モデル
### NN

nullモデル(目的変数の集団間変動を確認)
```{r NN nullモデル}
library(lmerTest)
model.Null <- lmer(Nostalgia ~ 1 + (1|no), data = NN, REML=FALSE)
summary(model.Null)
```

ランダム切片モデル
```{r NNモデル}
model.NN <- lmer(Nostalgia~ 1 + Arousal.cwc + Valence.cwc + SongFamiliarity.cwc + 
                      GenreFamiliarity.cwc +AutobiographicalSalience.cwc + 
                      Aethetic.cwc + Impression.cwc + NoPositive.cwc + 
                      NoNegative.cwc + MixEmotion +(1|no),
                   data = NN, REML=FALSE)
summary(model.NN)
```

多重共線性の確認
```{r NN_多重共線性}
library(car)
vif(model.NN)
```

### AN
nullモデル(目的変数の集団間変動を確認)
```{r AN_nullモデル}
model.Null <- lmer(Nostalgia ~ 1 + (1|no), data = AN, REML=FALSE)
#ランダム切片モデル
model.AN <- lmer(Nostalgia~ Arousal.cwc + Valence.cwc + SongFamiliarity.cwc + 
                      GenreFamiliarity.cwc +AutobiographicalSalience.cwc + 
                      Aethetic.cwc + Impression.cwc + NoPositive.cwc + 
                      NoNegative.cwc + MixEmotion +(1|no),
                    data = AN, REML=FALSE)
```


```{r AN_多重共線性}
summary(model.AN)
vif(model.AN)
```

Coefficient Plot
```{r Context_CoefficientPlot}
library(sjPlot)
ContextLevel_CoefficientPlot <- plot_models(model.NN, grid = FALSE, show.p=TRUE, 
                                            show.values=TRUE, colors ="gs", vline.color = "grey", 
              axis.labels = c("混合感情の有無", "ネガティブ感情数","ポジティブ感情数",
                "感動", "美しさ", "自伝的繋がり", "ジャンルに対する親近性", 
                "曲に対する親近性", "感情価", "覚醒度"),
              value.size = 3.8,
              grid.breaks = c(-1, -0.75, -0.5,-0.25, 0, 0.25,0.5, 0.75, 1), 
              show.legend = TRUE, m.labels = "聴取経験を伴わない\nノスタルジア") + 
  theme_light() +
  labs(colour = "従属変数", y = "推定値") +
  theme(plot.title= element_text(hjust = 0.5, size = 15, face = "bold", colour = 1), 
        axis.title = element_text(size = 10, face = "bold", colour = 1),
        axis.text.y = element_text(size=12, face = "bold", colour = 1),
        axis.text.x = element_text(size=10, colour = 1), 
        legend.text = element_text(size=10, colour = 1))+ 
  theme_minimal(base_family =family_sans)

#ANモデルのCoefficientをForestTreeとしてplot
ContextLevel_CoefficientPlot_AN <- plot_models(model.AN, grid = FALSE, show.p=TRUE, 
                                            show.values=TRUE,  colors ="gs",vline.color = "grey", 
                                            axis.labels = c(
                                              "混合感情の有無", "ネガティブ感情数","ポジティブ感情数",
                                              "感動", "美しさ", "自伝的繋がり", 
                                              "ジャンルに対する親近性", "曲に対する親近性", "感情価", "覚醒度"),
                                            grid.breaks = c(-1, -0.75, -0.5,-0.25, 0, 0.25,0.5, 0.75, 1),
                                            value.size = 3.8,
                                            show.legend = TRUE, m.labels = "聴取経験を伴った\nノスタルジア") + 
  theme_light() +
  labs(colour = "従属変数", 
       y = "推定値") +
  theme(plot.title= element_text(hjust = 0.5, size = 15, face = "bold", colour = 1), 
        axis.title = element_text(size = 10, face = "bold", colour = 1),
        axis.text.y = element_text(size=12, face = "bold", colour = 1),
        axis.text.x = element_text(size=10, colour = 1), 
        legend.text = element_text(size=10, colour = 1)) + 
   theme_minimal(base_family = family_sans)


ContextLevel_CoefficientPlot
ContextLevel_CoefficientPlot_AN
```


# 個人レベル解析
尺度の各因子の信頼係数

SNS
```{r SNS_α}
df_Person %>% dplyr::select(SNS_1, SNS_2, SNS_3, SNS_4, SNS_5) %>% alpha()
```

NP
```{r NP_α}
#Positive(0.8864823)
df_Person %>% dplyr::select(starts_with("NP")) %>% dplyr::select(ends_with("P")) %>% alpha()
  #Negative(0.8593577)
df_Person %>% dplyr::select(starts_with("NP")) %>% dplyr::select(ends_with("N")) %>% alpha()
  #回想（	0.8947744	）
df_Person %>% dplyr::select(starts_with("NP")) %>% dplyr::select(ends_with("K")) %>% alpha()
```

FFM（TIPI-J）
```{r TIPI-J_α}
  #Extraversion(0.578)
df_Person %>% dplyr::select(FFM_1, FFM_6) %>% transmute(FFM_1 = FFM_1, FFM_6 = 8 - FFM_6) %>% alpha()
  #Agreeableness(0.538)
df_Person %>% dplyr::select(FFM_2, FFM_7) %>% transmute(FFM_2 = 8 - FFM_2, FFM_7 = FFM_7) %>% alpha()
  #Conscientiousness(0.619)
df_Person %>% dplyr::select(FFM_3, FFM_8) %>% transmute(FFM_3 = FFM_3, FFM_8 = 8 - FFM_8) %>% alpha()
  #Neuroticism(0.462)
df_Person %>% dplyr::select(FFM_4, FFM_9) %>% transmute(FFM_4 = FFM_4, FFM_9 = 8 - FFM_9) %>% alpha()
  #Openess(0.625)
df_Person %>% dplyr::select(FFM_5, FFM_10) %>% transmute(FFM_5 = FFM_5, FFM_10 = 8 - FFM_10) %>% alpha()
```

ANPS
```{r ANPS_α}
#Play(0.72)
df_Person %>% dplyr::select(ANPS_1,ANPS_9, ANPS_13, ANPS_19, ANPS_22, ANPS_29) %>% alpha(check.keys=TRUE)
  #Anger(0.74)
df_Person %>% dplyr::select(ANPS_2,ANPS_5, ANPS_11, ANPS_20, ANPS_24, ANPS_26) %>% alpha(check.keys=TRUE)
  #Seek(0.710)
df_Person %>% dplyr::select(ANPS_3,ANPS_21, ANPS_25, ANPS_28, ANPS_31, ANPS_33) %>% alpha(check.keys=TRUE)
  #Care(0.38: 極めて低い)
df_Person %>% dplyr::select(ANPS_4,ANPS_14,ANPS_16, ANPS_27) %>% alpha(check.keys=TRUE)
  #Fear(0.86)
df_Person %>% dplyr::select(ANPS_6,ANPS_15, ANPS_17, ANPS_23, ANPS_30) %>% alpha(check.keys=TRUE)
  #Sadness(0.83)
df_Person %>% dplyr::select(ANPS_7,ANPS_8, ANPS_10, ANPS_12, ANPS_18, ANPS_32) %>% alpha(check.keys=TRUE)
```

PANAS
```{r PANAS_α}
  #Positive
df_Person %>% dplyr::select(starts_with("PANAS") & ends_with("P")) %>% alpha()
  #Negative
df_Person %>% dplyr::select(starts_with("PANAS") & ends_with("N")) %>% alpha()
```

得点平均, range

SNS
```{r SNS_summary}
df_Person %>% dplyr::select(SNS_1, SNS_2, SNS_3, SNS_4, SNS_5) %>% transmute(
  sum = rowSums(.),
  sd = round(sd(sum),2),
  mean = round(mean(sum),2),
  min = min(sum),
  max = max(sum))
```

NP
```{r NP_summary}
#NP
  #Positive(0.8864823)
df_Person %>% dplyr::select(starts_with("NP")) %>% dplyr::select(ends_with("P")) %>% transmute(
  sum = rowSums(.),
  sd = round(sd(sum),2),
  mean = round(mean(sum),2),
  min = min(sum),
  max = max(sum))
  #Negative(0.8593577)
df_Person %>% dplyr::select(starts_with("NP")) %>% dplyr::select(ends_with("N")) %>%  transmute(
  sum = rowSums(.),
  sd = round(sd(sum),2),
  mean = round(mean(sum),2),
  min = min(sum),
  max = max(sum))
  #回想（	0.8947744	）
df_Person %>% dplyr::select(starts_with("NP")) %>% dplyr::select(ends_with("K")) %>%  transmute(
  sum = rowSums(.),
  sd = round(sd(sum),2),
  mean = round(mean(sum),2),
  min = min(sum),
  max = max(sum))
```

FFM
```{r FFM_summary}
#FFM（TIPI-J）
  #Extraversion(0.578)
df_Person %>% dplyr::select(FFM_1, FFM_6) %>% transmute(FFM_1 = FFM_1, FFM_6 = 8 - FFM_6) %>% transmute(
  sum = rowSums(.),
  sd = round(sd(sum),2),
  mean = round(mean(sum),2),
  min = min(sum),
  max = max(sum))
  #Agreeableness(0.538)
df_Person %>% dplyr::select(FFM_2, FFM_7) %>% transmute(FFM_2 = 8 - FFM_2, FFM_7 = FFM_7) %>% transmute(
  sum = rowSums(.),
  sd = round(sd(sum),2),
  mean = round(mean(sum),2),
  min = min(sum),
  max = max(sum))
  #Conscientiousness(0.619)
df_Person %>% dplyr::select(FFM_3, FFM_8) %>% transmute(FFM_3 = FFM_3, FFM_8 = 8 - FFM_8) %>% transmute(
  sum = rowSums(.),
  sd = round(sd(sum),2),
  mean = round(mean(sum),2),
  min = min(sum),
  max = max(sum))
  #Neuroticism(0.462)
df_Person %>% dplyr::select(FFM_4, FFM_9) %>% transmute(FFM_4 = FFM_4, FFM_9 = 8 - FFM_9) %>% transmute(
  sum = rowSums(.),
  sd = round(sd(sum),2),
  mean = round(mean(sum),2),
  min = min(sum),
  max = max(sum))
  #Openess(0.625)
df_Person %>% dplyr::select(FFM_5, FFM_10) %>% transmute(FFM_5 = FFM_5, FFM_10 = 8 - FFM_10) %>% transmute(
  sum = rowSums(.),
  sd = round(sd(sum),2),
  mean = round(mean(sum),2),
  min = min(sum),
  max = max(sum))
```

ANPS
```{r ANPS_summary}
#ANPS
#数値の置換
ANPS1 <- df_Person %>% dplyr::select(starts_with("ANPS")) %>%  mutate_if(is.double, as.character)
ANPS1 <- ANPS1 %>%  mutate_all(~ifelse(.=='6',1,.)) %>%
  mutate_all(~ifelse(.=='7',2,.)) %>% mutate_all(~ifelse(.=='8',3,.)) %>% 
  mutate_all(~ifelse(.=='9',4,.)) %>% mutate_all(~ifelse(.=='10',3,.)) %>% 
  mutate_if(is.character,as.numeric)
  
  #Play(0.72)
ANPS_Play <-ANPS1 %>% dplyr::select(ANPS_1,ANPS_9, ANPS_13, ANPS_19, ANPS_22, ANPS_29) %>% transmute(
  ANPS_1 = ANPS_1,
  ANPS_9 = ANPS_9, 
  ANPS_13 = ANPS_13, 
  ANPS_19 = ANPS_19, 
  ANPS_22 = 6 - ANPS_22, 
  ANPS_29 = 6 - ANPS_29) %>% transmute(
  sum = rowSums(.),
  ave = sum/6,
  sd = round(sd(sum),2),
  mean = round(mean(sum),2),
  min = min(sum),
  max = max(sum))
  #Anger(0.74)
ANPS_Anger <- ANPS1 %>% dplyr::select(ANPS_2,ANPS_5, ANPS_11, ANPS_20, ANPS_24, ANPS_26)%>% transmute(
  ANPS_2 = 6 - ANPS_2,
  ANPS_5, 
  ANPS_11 = 6-ANPS_11, 
  ANPS_20, 
  ANPS_24, 
  ANPS_26 = 6 - ANPS_26
) %>% transmute(
  sum = rowSums(.),
  ave = sum/6,
  sd = round(sd(sum),2),
  mean = round(mean(sum),2),
  min = min(sum),
  max = max(sum))
  #Seek(0.710)
ANPS_Seek <- ANPS1 %>% dplyr::select(ANPS_3,ANPS_21, ANPS_25, ANPS_28, ANPS_31, ANPS_33) %>% transmute(
  ANPS_3 = 6 - ANPS_3,
  ANPS_21, 
  ANPS_25,
  ANPS_28, 
  ANPS_31, 
  ANPS_33)%>% transmute(
  sum = rowSums(.),
  ave = sum/6,
  sd = round(sd(sum),2),
  mean = round(mean(sum),2),
  min = min(sum),
  max = max(sum))
  #Care(0.38: 極めて低い)
ANPS_Care <- ANPS1 %>% dplyr::select(ANPS_4,ANPS_14,ANPS_16, ANPS_27) %>% transmute(
  ANPS_4,
  ANPS_14,
  ANPS_16 = 6 - ANPS_16, 
  ANPS_27 = 6 - ANPS_27
)%>%transmute(
  sum = rowSums(.),
  ave = sum/4,
  sd = round(sd(sum),2),
  mean = round(mean(sum),2),
  min = min(sum),
  max = max(sum))
  #Fear(0.86)
ANPS_Fear <- ANPS1 %>% dplyr::select(ANPS_6,ANPS_15, ANPS_17, ANPS_23, ANPS_30) %>% transmute(
  ANPS_6,
  ANPS_15 = 6 - ANPS_15, 
  ANPS_17, 
  ANPS_23 = 6 - ANPS_23, 
  ANPS_30
)%>%transmute(
  sum = rowSums(.),
  ave = sum/5,
  sd = round(sd(sum),2),
  mean = round(mean(sum),2),
  min = min(sum),
  max = max(sum))
  #Sadness(0.83)
ANPS_Sadness <- df_Person %>% dplyr::select(ANPS_7,ANPS_8, ANPS_10, ANPS_12, ANPS_18, ANPS_32) %>% transmute(
  ANPS_7,ANPS_8, ANPS_10 = 6 - ANPS_10, ANPS_12, ANPS_18 = 6 - ANPS_18, ANPS_32 = 6 - ANPS_32
)%>%transmute(
  sum = rowSums(.),
  ave = sum/6,
  mean = mean(sum),
  sd = round(sd(sum),2),
  min = min(sum),
  max = max(sum))
```

PANAS
```{r PANAS_summary}
#PANAS
  #Positive
df_Person %>% dplyr::select(starts_with("PANAS") & ends_with("P")) %>%transmute(
  sum = rowSums(.),
  sd = round(sd(sum),2),
  mean = round(mean(sum),2),
  min = min(sum),
  max = max(sum))
  #Negative
df_Person %>% dplyr::select(starts_with("PANAS") & ends_with("N"))%>%transmute(
  sum = rowSums(.),
  sd = round(sd(sum),2),
  mean = round(mean(sum),2),
  min = min(sum),
  max = max(sum))
```

## FFMとANPS相関

FFMデータ整理
```{r FFMデータ整理}
#FFM（TIPI-J）
FFM <- df_Person %>% transmute(
  #Extraversion(0.578)
  外向性 =  FFM_1 + (8 - FFM_6),
  #Agreeableness(0.538)
  協調性 = (8 - FFM_2) + FFM_7,
  #Conscientiousness(0.619)
  勤勉性 = FFM_3 + (8 - FFM_8),
  #Neuroticism(0.462)
  神経症傾向 = FFM_4 +(8 - FFM_9),
  #Openess(0.625)
  開放性 = FFM_5 + (8 - FFM_10))
FFM
```

ANPSデータ整理
```{r ANPSデータ整理}
ANPS <- ANPS1 %>% transmute(
  #Play
  楽しみ = ANPS_1 + ANPS_9 + ANPS_13 + ANPS_19 + (6 - ANPS_22) + (6 - ANPS_29),
  #Anger
  怒り = (6 - ANPS_2) + ANPS_5 + (6-ANPS_11) + ANPS_20 + ANPS_24 + (6 - ANPS_26),
  #Seek
  探求 = (6 - ANPS_3) + ANPS_21 + ANPS_25 + ANPS_28 + ANPS_31 + ANPS_33,
  #Care(0.38: 極めて低い)
  慈しみ = ANPS_4 + ANPS_14 + (6 - ANPS_16) + (6 - ANPS_27),
  #Fear(0.86)
  恐れ = ANPS_6 + (6 - ANPS_15) + ANPS_17 + (6 - ANPS_23) + ANPS_30,
  #Sadness(0.83)
  悲しみ =  ANPS_7 + ANPS_8 + (6 - ANPS_10) + ANPS_12 + (6 - ANPS_18) + (6 - ANPS_32)
  )
ANPS
```

相関行列のデータ作成
```{r データ整理}
library(corrplot)
cordf <- tibble(FFM,ANPS)
cormat <- cor(cordf, method = "spearman") 

#p値の計算
testRes = cor.mtest(cordf, conf.level = 0.95)
p <- testRes$p
#色指定
library(colorspace)
col.mat <-colorRampPalette(c("blue","white","red"))
```


```{r 相関行列plot}
#相関行列plot
  par(family= "HiraKakuProN-W3")
  corrplot <- corrplot(cormat, method = "color", col = "white",type = "full", order = "original", 
         is.corr	= FALSE, outline = TRUE, tl.pos = 'lt', tl.col = "black", cl.pos = 'n',
         p.mat = p, sig.level = c("0.001", "0.01", "0.05"), 
         insig = 'label_sig',pch.cex = 0.9, pch.col = "black",tl.cex = 1.0, number.cex = 0.5, 
)

corrplot(cormat, method = "color", col = col.mat(100), type = "lower", order = "original", 
               addCoef.col = "black", outline = TRUE, tl.pos =  "n", cl.pos = 'r',
               tl.col = "black", tl.cex = 1.7, number.cex = 0.7,add = TRUE
               )
mtext("TIPI-JとANPSにおける相関行列", at=5, line=3.8, cex=1.0)
```



## 回帰分析
個人内でのノスタルジア平均
```{r ノスタルジア被験者内平均}
Person_NN <- filter(Context_all, Experience == 2) %>% select(
  Nostalgia = Nostalgia, No = no) %>% group_by(No) %>% 
  mutate(ave = mean(Nostalgia))
Person_NN <- Person_NN %>% group_by(No) %>% summarise(Ave = mean(Nostalgia))

Person_AN <- filter(Context_all, Experience == 1) %>% select( 
  Nostalgia = Nostalgia, No = no) %>% group_by(No) %>% 
  mutate(ave = mean(Nostalgia))
Person_AN <- Person_AN %>% dplyr::group_by(No) %>% dplyr::summarise(Ave = mean(Nostalgia))

head(Person_NN)
head(Person_AN)
```

AN条件に存在しない被験者番号の削除
```{r ns}
ns <- c(9,10,15,26)
```


SNS
```{r SNSreg}
#平均でスコア化
SNSzave <- df_Person$SNS_ave %>% scale()

#NN
SNS.lm <- lm(Person_NN$Ave ~ SNSzave)
summary(SNS.lm)

#AN
SNS_AN <- SNSzave[-ns,]
SNS_AN.lm <- lm(Person_AN$Ave ~ SNS_AN)
summary(SNS_AN.lm)

```

NP
```{r NP_reg}
#平均でスコア化
NP <- dplyr::select(df_Person, dplyr::starts_with("NP")) %>% scale() %>% as.data.frame()
NP_P <- dplyr::select(NP, dplyr::ends_with("P")) %>%  dplyr::transmute( Positive = rowMeans(.)) %>% scale()
NP_N <- dplyr::select(NP, dplyr::ends_with("N")) %>%  dplyr::transmute( Negative = rowMeans(.)) %>% scale()
NP_K <- dplyr::select(NP, dplyr::ends_with("K")) %>%  dplyr::transmute( Kaisou = rowMeans(.)) %>% scale()
NP_all <- cbind(NP_P, NP_N, NP_K) %>% as.data.frame()

#NN
NP.lm <- lm(Person_NN$Ave ~ NP_P + NP_N + NP_K)
summary(NP.lm )

#AN
NP_P_AN <- NP_P[-ns,]
NP_N_AN <- NP_N[-ns,]
NP_K_AN <- NP_K[-ns,]
NP_AN.lm <- lm(Person_AN$Ave ~ NP_P_AN + NP_N_AN + NP_K_AN)
summary(NP_AN.lm)

```

FFM
```{r FFMreg}
#平均でスコア化
FFM_reg <- scale(FFM/2)  %>%as.data.frame() 
#NN
FFM.lm <- lm(Person_NN$Ave ~ FFM_reg$外向性 + FFM_reg$協調性 + 
               FFM_reg$勤勉性 + FFM_reg$神経症傾向 + FFM_reg$開放性)

summary(FFM.lm)
#AN
FFM_AN_reg <- FFM[-ns,]
FFM_AN.lm <- lm(Person_AN$Ave ~ FFM_AN_reg$外向性 + FFM_AN_reg$協調性 + 
                  FFM_AN_reg$勤勉性 + FFM_AN_reg$神経症傾向 + FFM_AN_reg$開放性)

summary(FFM_AN.lm)
```


ANPS
```{r ANPSreg}
#平均でスコア化
ANPS_reg <- tibble(楽しみ = ANPS_Play$ave,怒り = ANPS_Anger$ave,探求 = ANPS_Seek$ave,慈しみ = ANPS_Care$ave,恐れ = ANPS_Fear$ave,悲しみ = ANPS_Sadness$ave)
ANPS_reg <- sapply(ANPS_reg,scale) 
ANPS_reg <- as.data.frame(ANPS_reg)

#NN
ANPS.lm <- lm(Person_NN$Ave ~ ANPS_reg$楽しみ + ANPS_reg$探求 + ANPS_reg$慈しみ + 
                ANPS_reg$恐れ + ANPS_reg$怒り + ANPS_reg$悲しみ)
summary(ANPS.lm)
#AN
ANPS_AN <- ANPS_reg[-ns,]
ANPS_AN.lm <- lm(Person_AN$Ave ~ ANPS_AN$楽しみ + ANPS_AN$探求 + ANPS_AN$慈しみ + 
                ANPS_AN$恐れ + ANPS_AN$怒り + ANPS_AN$悲しみ)
summary(ANPS_AN.lm)
```
PANAS
```{r PANASreg}
  #Positive
PANAS_P <- df_Person %>% dplyr::select(starts_with("PANAS") & ends_with("P"))%>%transmute(
  sum = rowSums(.),
  ave = sum/8,0)
  #Negative
PANAS_N <- df_Person %>% dplyr::select(starts_with("PANAS") & ends_with("N"))%>%transmute(
  sum = rowSums(.),
  ave = sum/8)
PANAS_reg <- cbind(Positive = PANAS_P$ave, Negative = PANAS_N$ave) %>% scale() %>% as.data.frame()

#重回帰分析
PANAS.lm <- lm(Person_NN$Ave ~ PANAS_reg$Positive + PANAS_reg$Negative)
summary(PANAS.lm )
  #→ネガティブ感情が有意(<.01)
#AN
PANAS_AN <- PANAS_reg[-ns,]
PANAS_AN.lm <- lm(Person_AN$Ave ~ PANAS_AN$Positive + PANAS_AN$Negative)
summary(PANAS_AN.lm )
```

### Coefficient Plot
データ作成
```{r データ作成}
PersonLevel_multi <- cbind(SNS = SNSzave, NP = NP_all, ANPS = ANPS_reg, FFM = FFM_reg, PANAS = PANAS_reg)  %>% tibble::rowid_to_column("no") 

PersonLevel_Plot <- cbind(PersonLevel_multi, NNave = Person_NN$Ave)
PersonLevel_Plot_AN <- cbind(PersonLevel_multi[-ns,], ANave = Person_AN$Ave)

#再定義
SNS.lm.plot <- lm(NNave ~ SNSzave, data =PersonLevel_Plot)
NP.lm.plot <- lm(NNave ~ NP.Positive + NP.Negative + NP.Kaisou, data =PersonLevel_Plot)
ANPS.lm.plot <- lm(NNave ~ ANPS.楽しみ + ANPS.探求 + ANPS.慈しみ + 
                     ANPS.恐れ + ANPS.怒り + ANPS.悲しみ, data =PersonLevel_Plot )
FFM.lm.plot <- lm(NNave ~ FFM.外向性 + FFM.協調性 + 
               FFM.勤勉性 + FFM.神経症傾向 + FFM.開放性, data =PersonLevel_Plot)
PANAS.lm.plot <- lm(NNave ~ PANAS.Positive + PANAS.Negative, data =PersonLevel_Plot)
#AN
SNS.lm.plot_AN <- lm(ANave ~ SNS_AN, data =PersonLevel_Plot_AN)
NP.lm.plot_AN <- lm(ANave ~ NP.Positive + NP.Negative + NP.Kaisou, data =PersonLevel_Plot_AN)
ANPS.lm.plot_AN <- lm(ANave ~ ANPS.楽しみ + ANPS.探求 + ANPS.慈しみ + 
                     ANPS.恐れ + ANPS.怒り + ANPS.悲しみ, data =PersonLevel_Plot_AN)
FFM.lm.plot_AN <- lm(ANave ~ FFM.外向性 + FFM.協調性 + 
               FFM.勤勉性 + FFM.神経症傾向 + FFM.開放性, data =PersonLevel_Plot_AN)
PANAS.lm.plot_AN <- lm(ANave ~ PANAS.Positive + PANAS.Negative, data =PersonLevel_Plot_AN)

```

Coefficient Plot
```{r Person_CoefficientPlot}
library(sjPlot)
PersonLevel_CoefficientPlot <- plot_models(SNS.lm.plot, NP.lm.plot, ANPS.lm.plot, 
                                           FFM.lm.plot, PANAS.lm.plot, 
                                           show.p=TRUE, show.values=TRUE, 
                                           p.threshold = c(0.05, 0.01, 0.001), 
                                           value.size = 3.5,
                                           vline.color = "grey", 
                                           m.labels = c("SNS平均", "NP因子", "ANPS因子", 
                                                        "FFM因子", "PANAS因子"),
                                           grid.breaks = c(-1, -0.75, -0.5,-0.25, 0, 0.25,0.5, 0.75, 1),
                                           axis.labels = c("PANAS.ネガティブ","PANAS.ポジティブ",
                                                           "FFM.開放性","FFM.情緒不安定性",
                                                           "FFM.誠実性","FFM.調和性","FFM.外向性",
                                                           "ANPS.悲しみ","ANPS.怒り",
                                                           "ANPS.恐れ","ANPS.慈しみ","ANPS.探求", "ANPS.楽しみ",
                                                           "NP.回想", "NP.ネガティブ", "NP.ポジティブ", "SNS"
                                           )) + 
  theme_light() + 
  labs(colour = "聴取経験を伴わない\nノスタルジア経験", 
       y = "推定値") +
  theme(plot.title= element_text(hjust = 0.5, size = 15, face = "bold", colour = 1), 
        axis.title = element_text(size = 10, face = "bold", colour = 1),
        axis.text.y = element_text(size=12, face = "bold", colour = 1),
        axis.text.x = element_text(size=10, colour = 1), 
        legend.text = element_text(size=10, colour = 1))

#AN Coefficient plot
PersonLevel_CoefficientPlot_AN <- plot_models(SNS.lm.plot_AN, NP.lm.plot_AN, ANPS.lm.plot_AN, 
                                           FFM.lm.plot_AN, PANAS.lm.plot_AN, 
                                           show.p=TRUE, show.values=TRUE, 
                                           p.threshold = c(0.05, 0.01, 0.001), 
                                           value.size = 3.5,
                                           vline.color = "grey", 
                                           m.labels = c("SNS平均", "NP因子", "ANPS因子", 
                                                        "FFM因子", "PANAS因子"),
                                           grid.breaks = c(-1, -0.75, -0.5,-0.25, 0, 0.25,0.5, 0.75, 1),
                                           axis.labels = c("PANAS.ネガティブ","PANAS.ポジティブ",
                                                           "FFM.開放性","FFM.情緒不安定性",
                                                           "FFM.誠実性","FFM.調和性","FFM.外向性",
                                                           "ANPS.悲しみ","ANPS.怒り",
                                                           "ANPS.恐れ","ANPS.慈しみ","ANPS.探求", "ANPS.楽しみ",
                                                           "NP.回想", "NP.ネガティブ", "NP.ポジティブ", "SNS"
                                                           )) + 
  theme_light() + 
  labs(colour = "聴取経験を伴った\nノスタルジア経験", y = "推定値") +
  theme(plot.title= element_text(hjust = 0.5, size = 15, face = "bold", colour = 1), 
        axis.title = element_text(size = 10, face = "bold", colour = 1),
        axis.text.y = element_text(size=12, face = "bold", colour = 1),
        axis.text.x = element_text(size=10, colour = 1), 
        legend.text = element_text(size=10, colour = 1))
```


### 全て含めた回帰モデル
```{r 全部}

All_NN.lm <- lm(NNave ~ SNSzave + NP.Positive + NP.Negative + NP.Kaisou + ANPS.楽しみ + 
               ANPS.探求 + ANPS.慈しみ + ANPS.恐れ + ANPS.怒り + ANPS.悲しみ + 
               FFM.外向性 + FFM.協調性 + FFM.勤勉性 + FFM.神経症傾向 + FFM.開放性 + 
               PANAS.Positive + PANAS.Negative, data =PersonLevel_Plot)
summary(All_NN.lm)
#AN
All_AN.lm <- lm(ANave ~ SNS_AN + NP.Positive + NP.Negative + NP.Kaisou + ANPS.楽しみ + 
               ANPS.探求 + ANPS.慈しみ + ANPS.恐れ + ANPS.怒り + ANPS.悲しみ + 
               FFM.外向性 + FFM.協調性 + FFM.勤勉性 + FFM.神経症傾向 + FFM.開放性 + 
               PANAS.Positive + PANAS.Negative, data =PersonLevel_Plot_AN)
summary(All_AN.lm)
```
### ノスタルジア傾向に対するモデル

```{r SNS~性格}
#SNSは正規化してない平均を使用
SNSave <- df_Person %>% dplyr::select(SNS_1, SNS_2, SNS_3, SNS_4, SNS_5) %>% transmute(
  ave = rowMeans(.))
SNS_ANPS.lm <- lm(SNSave$ave ~ ANPS_reg$楽しみ + ANPS_reg$探求 + ANPS_reg$慈しみ + 
                    ANPS_reg$恐れ + ANPS_reg$怒り + ANPS_reg$悲しみ)
summary(SNS_ANPS.lm)

SNS_FFM.lm <- lm(SNSave$ave ~ FFM_reg$外向性 + FFM_reg$協調性 + FFM_reg$勤勉性 + 
                   FFM_reg$神経症傾向 + FFM_reg$開放性)
summary(SNS_FFM.lm)
```

```{r NP~性格}
#NPは正規化されてない平均を使用
NP_P_nz <-  df_Person %>% select(starts_with("NP")) %>% select(ends_with("P")) %>%
  dplyr::transmute( Positive = rowMeans(.))
NP_N_nz <-  df_Person %>% select(starts_with("NP")) %>% select(ends_with("N")) %>% 
  dplyr::transmute( Negative = rowMeans(.))
NP_K_nz <-  df_Person %>% select(starts_with("NP")) %>% select(ends_with("K")) %>% 
  dplyr::transmute( Kaisou = rowMeans(.))

#ANPS
#Positive
NP_P_ANPS.lm <- lm(NP_P_nz$Positive ~ ANPS_reg$楽しみ + ANPS_reg$探求 + ANPS_reg$慈しみ + 
                    ANPS_reg$恐れ + ANPS_reg$怒り + ANPS_reg$悲しみ)
summary(NP_P_ANPS.lm)
#Negative
NP_N_ANPS.lm <- lm(NP_N_nz$Negative ~ ANPS_reg$楽しみ + ANPS_reg$探求 + ANPS_reg$慈しみ + 
                    ANPS_reg$恐れ + ANPS_reg$怒り + ANPS_reg$悲しみ)
summary(NP_N_ANPS.lm)
#Kaisou
NP_K_ANPS.lm <- lm(NP_K_nz$Kaisou ~ ANPS_reg$楽しみ + ANPS_reg$探求 + ANPS_reg$慈しみ + 
                    ANPS_reg$恐れ + ANPS_reg$怒り + ANPS_reg$悲しみ)
summary(NP_K_ANPS.lm)

#FFM
#Positive
NP_P_FFM.lm <- lm(NP_P_nz$Positive ~ FFM_reg$外向性 + FFM_reg$協調性 + FFM_reg$勤勉性 + 
                   FFM_reg$神経症傾向 + FFM_reg$開放性)
summary(NP_P_FFM.lm)
#Negatie
NP_N_FFM.lm <- lm(NP_N_nz$Negative ~ FFM_reg$外向性 + FFM_reg$協調性 + FFM_reg$勤勉性 + 
                   FFM_reg$神経症傾向 + FFM_reg$開放性)
summary(NP_N_FFM.lm)
#Kaisou
NP_K_FFM.lm <- lm(NP_K_nz$Kaisou ~ FFM_reg$外向性 + FFM_reg$協調性 + FFM_reg$勤勉性 + 
                   FFM_reg$神経症傾向 + FFM_reg$開放性)
summary(NP_K_FFM.lm)
```

# 離散感情

データ作成
```{r 感情データ作成}
#Emotion列だけの数値データを読み込み
Emotion_num <- read.csv("~/OneDrive - keio.jp/藤井研/個人研究/個人差実験/実験1/NostalgiaPersonality_Emotion_20220514_number.csv",header = T) %>%
  as_tibble() %>% pivot_longer(cols = everything())  %>% arrange(name) %>%  select(Emotion = value)
#Emorion + No + 聴取経験 + ノスタルジア
Emotion_nos <- tibble(Emotion_num, 
                      no = rep(1:33,54),
                      df_Context %>% select(.,contains("Experience")) %>% 
                        pivot_longer(cols = everything(), values_to = "Experience") %>% 
                        arrange(name) %>% select(-name),
                      df_Context %>% select(.,contains("Nostalgia")) %>% 
                        pivot_longer(cols = everything(), values_to = "Nostalgia") %>% 
                        arrange(name) %>% select(-name))
#2以上
Emotion_HighNN <- filter(Emotion_nos, Experience == 2 & Nostalgia > 1)
Emotion_HighAN <- filter(Emotion_nos, Experience == 1 & Nostalgia > 1)

#感情ベクトルで一行に入ってる複数の感情を,で区切る
xx <- as.data.frame(as.numeric(unlist(str_split(Emotion_HighNN$Emotion, pattern = ",")))) 
colnames(xx) <- "Nostalgia"
Emotion_HighAN1 <- as.data.frame(as.numeric(unlist(str_split(Emotion_HighAN$Emotion, pattern = ",")))) 
colnames(Emotion_HighAN1) <- "Nostalgia"

#ポジティブとネガティブに分ける
Positive <- filter(xx, Nostalgia < 13)
Positive$Nostalgia <- as.character(Positive$Nostalgia)
Negative <- filter(xx, Nostalgia > 12)
Negative$Nostalgia <- as.character(Negative$Nostalgia)
#29→28に変換
Negative$Nostalgia <- gsub("29", "28",Negative$Nostalgia)


#AN
Positive_AN <- filter(Emotion_HighAN1, Nostalgia < 13)
Positive_AN$Nostalgia <- as.character(Positive_AN$Nostalgia)
Negative_AN <- filter(Emotion_HighAN1, Nostalgia > 12)
Negative_AN$Nostalgia <- as.character(Negative_AN$Nostalgia)
#29→28に変換
Negative_AN$Nostalgia <- gsub("29", "28",Negative_AN$Nostalgia)

#感情を名前にする
library(mgsub)
Positive$name <- mgsub::mgsub(Positive$Nostalgia, c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12"), 
             c("愛情", "憧れ","喜び", "陽気さ", "愛着", "満足感", 
               "切望", "誇り", "驚き", "魅了", "熱情", "安心感"))

Negative$name <- mgsub::mgsub(Negative$Nostalgia, c("13", "14", "15", "16", "17", 
                                                    "18", "19", "20", "21", "22", 
                                                    "23", "24", "25", "26", "27", "28"), 
                              c("悲しみ", "失望","苦しみ", "あわれみ", 
                                "苛立ち", "怒り", "憤慨", "激怒", 
                                "嫌気", "羨望", "無関心", "苦痛", "羞恥", 
                                "緊張", "不安", "恐怖"))
Positive_AN$name <- mgsub::mgsub(Positive_AN$Nostalgia, c("1", "2", "3", "4", 
                                                          "5", "6", "7", "8", "9", "10", "11", "12"),
                                 c("愛情", "憧れ","喜び", "陽気さ", "愛着", "満足感", 
                                   "切望", "誇り", "驚き", "魅了", "熱情", "安心感"))
Negative_AN$name <- mgsub::mgsub(Negative_AN$Nostalgia, c("13", "14", "15", "16", "17", 
                                                    "18", "19", "20", "21", "22", 
                                                    "23", "24", "25", "26", "27", "28"), 
                              c("悲しみ", "失望","苦しみ", "あわれみ", 
                                "苛立ち", "怒り", "憤慨", "激怒", 
                                "嫌気", "羨望", "無関心", "苦痛", "羞恥", 
                                "緊張", "不安", "恐怖"))


#割合の算出, 感情タイプ因子の追加
Proportions_P <- Positive %>% group_by(name) %>% tally() %>% 
  mutate(pro = n / sum(n), 
         factor = case_when(
           name == "愛情" | name == "憧れ" | name =="愛着" | 
              name =="切望" ~"1",
           name == "喜び"| name =="陽気さ" | name == "満足感" | 
             name =="魅了"|name =="誇り" | name =="熱情" | name =="安心感"~"2",
           name == "驚き"~"3"
         ))
Proportions_N <- Negative %>% group_by(name) %>% tally() %>% 
  mutate(pro = n / sum(n),
         factor = case_when(
           name == "悲しみ" | name == "失望" | name =="苦しみ" | 
            name =="あわれみ"| name =="無関心"| name =="羞恥" ~"1",
          name == "苛立ち"| name =="怒り" | name == "憤慨" | 
            name =="激怒" | name =="嫌気" | name =="羨望"| name =="苦痛" ~"2",
          name == "緊張"| name =="恐れ"| name =="恐怖"~"3"
  ))

Proportions_P_AN <- Positive_AN %>% group_by(name) %>% tally() %>% 
  mutate(pro = n / sum(n), 
         factor = case_when(
           name == "愛情" | name == "憧れ" | name =="愛着" | 
              name =="切望" ~"1",
           name == "喜び"| name =="陽気さ" | name == "満足感" | 
             name =="魅了"|name =="誇り" | name =="熱情" | name =="安心感"~"2",
           name == "驚き"~"3"
         ))
Proportions_N_AN <- Negative_AN %>% group_by(name) %>% tally() %>% 
  mutate(pro = n / sum(n),
         factor = case_when(
           name == "悲しみ" | name == "失望" | name =="苦しみ" | 
            name =="あわれみ"| name =="無関心"| name =="羞恥" ~"1",
          name == "苛立ち"| name =="怒り" | name == "憤慨" | 
            name =="激怒" | name =="嫌気" | name =="羨望"| name =="苦痛" ~"2",
          name == "緊張"| name =="恐れ"| name =="恐怖"~"3"
  ))

```

一つずつplot
```{r 条件ごとの感情plot}
library(ggsci)
#設定
Theme <- ggplot2::theme(plot.title= element_text(size = 14, face = "bold", colour = 1,), 
               axis.title.x = element_text(size = 12, face = "bold", colour = 1), 
               axis.title.y = element_text(size=13, face = "bold", colour = 1), 
               panel.background = element_rect(fill = "white", colour = "black", size = 0.7),
               axis.text = element_text(size = 10, colour = "black"), 
               axis.text.y = element_text(size=12, face = "bold", colour = 1),
               aspect.ratio=5/7) 
#描写
#NN
NN_Positive <- ggplot2::ggplot(data = Proportions_P, aes(x = pro, y = reorder(name, pro), fill = factor)) +  
  geom_bar(stat="identity", color = "black") + 
  labs(title = "Nostalgic Without Experience", x = "割合", y = "肯定的感情", caption  = "N = 105") + 
  theme_classic() + Theme + 
  scale_x_continuous(expand = c(0,0), limits = c(0,0.3),
                     breaks = seq(0, 0.3, by = 0.1),
                     labels = c(0.0,0.1,0.2,0.3)) + 
  scale_fill_manual(values = c(
                         "1" = "white",
                         "2" = "black",
                         "3" = "grey"), guide = "none") #+ scale_fill_discrete(guide = FALSE) 

NN_Negative <- ggplot(data = Proportions_N, aes(x = pro, y = reorder(name, pro), fill = factor)) +  
  geom_bar(stat="identity", color = "black") + 
  labs(title = "Nostalgic Without Experience", x = "割合", y = "否定的感情", caption  = "N = 105") + 
  theme_classic() + Theme + 
  scale_x_continuous(expand = c(0,0), limits = c(0,0.4),
                     breaks = seq(0, 0.4, by = 0.1),
                     labels = c(0.0,0.1,0.2,0.3, 0.4))+ 
  scale_fill_manual(values = c(
    "1" = "white",
    "2" = "black",
    "3" = "grey"), guide = "none")

#AN
AN_Positive <- ggplot(data = Proportions_P_AN, aes(x = pro, y = reorder(name, pro), fill = factor)) +  
  geom_bar(stat="identity", color = "black") + 
  labs(title = "Nostalgic With Experience", x = "割合", y = "肯定的感情", caption  = "N = 173") + 
  theme_classic() + Theme + 
  scale_x_continuous(expand = c(0,0), limits = c(0,0.3),
                     breaks = seq(0, 0.3, by = 0.1),
                     labels = c(0.0,0.1,0.2,0.3)) + 
  scale_fill_manual(values = c(
    "1" = "white",
    "2" = "black",
    "3" = "grey"), guide = "none") #+ scale_fill_discrete(guide = FALSE) 

AN_Negative <- ggplot(data = Proportions_N_AN, aes(x = pro, y = reorder(name, pro), fill = factor)) +  
  geom_bar(stat="identity", color = "black") + 
  labs(title = "Nostalgic With Experience", x = "割合", y = "否定的感情", caption  = "N = 173") + 
  theme_classic() + Theme + 
  scale_x_continuous(expand = c(0,0), limits = c(0,0.4),
                     breaks = seq(0, 0.4, by = 0.1),
                     labels = c(0.0,0.1,0.2,0.3, 0.4))+ 
  scale_fill_manual(values = c(
    "1" = "white",
    "2" = "black",
    "3" = "grey"), guide = "none")
```



ポジティブ感情とネガティブ感情の各条件における比率
```{r ポジネガ比率}
PosiNega_NN <- Context_all %>% filter(Experience == 2 & Nostalgia>1) %>% select(NoPositive, NoNegative) %>% colSums() 
PosiNega_AN <- Context_all %>% filter(Experience == 1 & Nostalgia>1) %>% select(NoPositive, NoNegative) %>% colSums()

#NN条件での比率
PosiNega_NN[1]/PosiNega_NN[2]
#AN条件での比率
PosiNega_AN[1]/PosiNega_AN[2]
```

混合感情
```{r  mix比率}
Mix_NN <- Context_all %>% filter(Experience == 2 & Nostalgia>1) %>% select(no,MixEmotion) %>% 
  group_by(no) %>% summarise(all = n(), mix = sum(MixEmotion ==1), pro = mix/all)
Mix_NN <- Mix_NN$pro
Mix_AN <- Context_all %>% filter(Experience == 1 & Nostalgia>1) %>% select(no,MixEmotion) %>% 
  group_by(no) %>% summarise(all = n(), mix = sum(MixEmotion ==1), pro = mix/all)
Mix_AN <- Mix_AN$pro
mean(Mix_NN)
sd(Mix_NN)/sqrt(length(Mix_NN))
mean(Mix_AN)
sd(Mix_AN)/sqrt(length(Mix_AN))


#t検定
t.test(Mix_NN,Mix_AN, var.equal=TRUE)
```

```{r ポジネガ比較}
PosiNegaOnly_NN <-  Context_all %>% filter(Experience == 2 & Nostalgia>1, MixEmotion == 0) %>% select(no,NoPositive, NoNegative) %>%
  group_by(no) %>% summarise(all = n(), Posinum = sum(NoPositive != 0), Posipro = Posinum/all, 
                             Neganum =sum(NoNegative != 0), NegaPro = Neganum/all)
PosiNegaOnly_AN <-  Context_all %>% filter(Experience == 1 & Nostalgia>1, MixEmotion == 0) %>% select(no,NoPositive, NoNegative) %>%
  group_by(no) %>% summarise(all = n(), Posinum = sum(NoPositive !=0), Posipro = Posinum/all, 
                             Neganum =sum(NoNegative !=0), NegaPro = Neganum/all)

#NN記述統計量
mean(PosiNegaOnly_NN$Posipro)
sd(PosiNegaOnly_NN$Posipro)/sqrt(length(PosiNegaOnly_NN$Posipro))
mean(PosiNegaOnly_NN$NegaPro)
sd(PosiNegaOnly_NN$NegaPro)/sqrt(length(PosiNegaOnly_NN$NegaPro))
#AN記述統計量
mean(PosiNegaOnly_AN$Posipro)
sd(PosiNegaOnly_AN$Posipro)/sqrt(length(PosiNegaOnly_AN$Posipro))
mean(PosiNegaOnly_AN$NegaPro)
sd(PosiNegaOnly_AN$NegaPro)/sqrt(length(PosiNegaOnly_AN$NegaPro))

#NNANポジ
t.test(PosiNegaOnly_NN$Posipro, PosiNegaOnly_AN$Posipro, var.equal=TRUE) 
#NNANネガ
t.test(PosiNegaOnly_NN$NegaPro, PosiNegaOnly_AN$NegaPro, var.equal=TRUE) 
```

